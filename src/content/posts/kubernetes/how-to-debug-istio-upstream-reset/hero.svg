<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 675" fill="none">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1200" y2="675" gradientUnits="userSpaceOnUse">
      <stop offset="0%" stop-color="#1a0505"/>
      <stop offset="100%" stop-color="#7f1d1d"/>
    </linearGradient>
    <marker id="arrow-ok" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#22c55e" fill-opacity="0.7"/>
    </marker>
    <marker id="arrow-err" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="7" markerHeight="7" orient="auto">
      <path d="M0,0 L10,5 L0,10 z" fill="#ef4444" fill-opacity="0.9"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="675" fill="url(#bg)"/>

  <!-- Subtle grid -->
  <g stroke="#dc2626" stroke-opacity="0.06" stroke-width="1">
    <line x1="0" y1="168" x2="1200" y2="168"/>
    <line x1="0" y1="337" x2="1200" y2="337"/>
    <line x1="0" y1="506" x2="1200" y2="506"/>
    <line x1="300" y1="0" x2="300" y2="675"/>
    <line x1="600" y1="0" x2="600" y2="675"/>
    <line x1="900" y1="0" x2="900" y2="675"/>
  </g>

  <!-- CLIENT -->
  <g transform="translate(70,185)">
    <rect x="0" y="0" width="120" height="80" rx="8" fill="#2a0a0a" stroke="#991b1b" stroke-width="1.5"/>
    <text x="60" y="45" text-anchor="middle" fill="#fca5a5" font-family="system-ui,sans-serif" font-size="15" font-weight="600">Client</text>
  </g>

  <!-- Client to Service A arrow -->
  <line x1="190" y1="225" x2="246" y2="225" stroke="#22c55e" stroke-width="2" stroke-opacity="0.6" marker-end="url(#arrow-ok)"/>

  <!-- SERVICE A POD -->
  <g transform="translate(260,50)">
    <rect x="0" y="0" width="240" height="350" rx="12" fill="#4c0519" fill-opacity="0.2" stroke="#be123c" stroke-width="2" stroke-dasharray="6 3"/>
    <text x="120" y="24" text-anchor="middle" fill="#fda4af" font-family="system-ui,sans-serif" font-size="13" font-weight="600">Pod: Service A</text>

    <!-- App container -->
    <g transform="translate(15,38)">
      <rect x="0" y="0" width="210" height="70" rx="8" fill="#2a0a0a" stroke="#991b1b" stroke-width="1.5"/>
      <circle cx="16" cy="16" r="5" fill="#22c55e" fill-opacity="0.8"/>
      <text x="27" y="19" fill="#86efac" font-family="system-ui,sans-serif" font-size="9">running</text>
      <text x="105" y="36" text-anchor="middle" fill="#e2e8f0" font-family="system-ui,sans-serif" font-size="13" font-weight="600">App Container</text>
      <text x="105" y="54" text-anchor="middle" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="10">port: 8080</text>
    </g>

    <!-- Envoy sidecar -->
    <g transform="translate(15,120)">
      <rect x="0" y="0" width="210" height="215" rx="8" fill="#1a0505" stroke="#be123c" stroke-width="2"/>
      <text x="105" y="22" text-anchor="middle" fill="#fb7185" font-family="system-ui,sans-serif" font-size="13" font-weight="700">Envoy Proxy</text>
      <text x="105" y="38" text-anchor="middle" fill="#881337" font-family="ui-monospace,monospace" font-size="9">istio-proxy</text>

      <g transform="translate(10,52)">
        <text x="0" y="0" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Listeners:</text>
        <text x="62" y="0" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="9">0.0.0.0:15006</text>
        <text x="0" y="16" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Upstream:</text>
        <text x="62" y="16" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="9">service-b:8080</text>
        <text x="0" y="32" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Clusters:</text>
        <text x="62" y="32" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="9">outbound|8080</text>
        <text x="0" y="48" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Status:</text>
        <text x="62" y="48" fill="#22c55e" font-family="ui-monospace,monospace" font-size="9">SYNCED</text>
      </g>

      <g transform="translate(10,118)">
        <rect x="0" y="0" width="190" height="20" rx="4" fill="#be123c" fill-opacity="0.1" stroke="#be123c" stroke-opacity="0.3" stroke-width="1"/>
        <text x="95" y="14" text-anchor="middle" fill="#fb7185" font-family="ui-monospace,monospace" font-size="9" font-weight="600">mTLS: STRICT</text>
      </g>

      <rect x="195" y="148" width="15" height="28" rx="3" fill="#be123c" fill-opacity="0.3"/>
      <text x="202" y="166" text-anchor="middle" fill="#fda4af" font-family="system-ui,sans-serif" font-size="10" font-weight="700">&gt;</text>
    </g>
  </g>

  <!-- SERVICE B POD -->
  <g transform="translate(720,50)">
    <rect x="0" y="0" width="240" height="350" rx="12" fill="#4c0519" fill-opacity="0.2" stroke="#be123c" stroke-width="2" stroke-dasharray="6 3"/>
    <text x="120" y="24" text-anchor="middle" fill="#fda4af" font-family="system-ui,sans-serif" font-size="13" font-weight="600">Pod: Service B</text>

    <!-- App container -->
    <g transform="translate(15,38)">
      <rect x="0" y="0" width="210" height="70" rx="8" fill="#2a0a0a" stroke="#991b1b" stroke-width="1.5"/>
      <circle cx="16" cy="16" r="5" fill="#eab308" fill-opacity="0.8"/>
      <text x="27" y="19" fill="#fde047" font-family="system-ui,sans-serif" font-size="9">restarting</text>
      <text x="105" y="36" text-anchor="middle" fill="#e2e8f0" font-family="system-ui,sans-serif" font-size="13" font-weight="600">App Container</text>
      <text x="105" y="54" text-anchor="middle" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="10">port: 8080</text>
    </g>

    <!-- Envoy sidecar -->
    <g transform="translate(15,120)">
      <rect x="0" y="0" width="210" height="215" rx="8" fill="#1a0505" stroke="#be123c" stroke-width="2"/>
      <text x="105" y="22" text-anchor="middle" fill="#fb7185" font-family="system-ui,sans-serif" font-size="13" font-weight="700">Envoy Proxy</text>
      <text x="105" y="38" text-anchor="middle" fill="#881337" font-family="ui-monospace,monospace" font-size="9">istio-proxy</text>

      <g transform="translate(10,52)">
        <text x="0" y="0" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Listeners:</text>
        <text x="62" y="0" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="9">0.0.0.0:15006</text>
        <text x="0" y="16" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Inbound:</text>
        <text x="62" y="16" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="9">127.0.0.1:8080</text>
        <text x="0" y="32" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Clusters:</text>
        <text x="62" y="32" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="9">inbound|8080</text>
        <text x="0" y="48" fill="#881337" font-family="ui-monospace,monospace" font-size="9">Status:</text>
        <text x="62" y="48" fill="#eab308" font-family="ui-monospace,monospace" font-size="9">NOT_READY</text>
      </g>

      <g transform="translate(10,118)">
        <rect x="0" y="0" width="190" height="20" rx="4" fill="#be123c" fill-opacity="0.1" stroke="#be123c" stroke-opacity="0.3" stroke-width="1"/>
        <text x="95" y="14" text-anchor="middle" fill="#fb7185" font-family="ui-monospace,monospace" font-size="9" font-weight="600">mTLS: STRICT</text>
      </g>

      <rect x="-15" y="148" width="15" height="28" rx="3" fill="#be123c" fill-opacity="0.3"/>
      <text x="-8" y="166" text-anchor="middle" fill="#fda4af" font-family="system-ui,sans-serif" font-size="10" font-weight="700">&gt;</text>
    </g>
  </g>

  <!-- ERROR TRAFFIC LINE -->
  <line x1="500" y1="220" x2="720" y2="220" stroke="#ef4444" stroke-width="3" stroke-opacity="0.7" marker-end="url(#arrow-err)" stroke-dasharray="10 5"/>

  <!-- X mark -->
  <g transform="translate(610,220)">
    <circle cx="0" cy="0" r="28" fill="#ef4444" fill-opacity="0.08"/>
    <circle cx="0" cy="0" r="18" fill="#ef4444" fill-opacity="0.12"/>
    <g stroke="#ef4444" stroke-width="3.5" stroke-linecap="round" stroke-opacity="0.9">
      <line x1="-10" y1="-10" x2="10" y2="10"/>
      <line x1="10" y1="-10" x2="-10" y2="10"/>
    </g>
  </g>

  <!-- ERROR BADGE -->
  <g transform="translate(470,430)">
    <rect x="0" y="0" width="280" height="70" rx="10" fill="#450a0a" fill-opacity="0.6" stroke="#ef4444" stroke-width="1.5"/>
    <text x="140" y="24" text-anchor="middle" fill="#fecaca" font-family="ui-monospace,monospace" font-size="13" font-weight="700">HTTP 502 Bad Gateway</text>
    <text x="140" y="44" text-anchor="middle" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="10">upstream_reset_before_</text>
    <text x="140" y="58" text-anchor="middle" fill="#fca5a5" font-family="ui-monospace,monospace" font-size="10">response_started{connection}</text>
  </g>

  <!-- DEBUG HINTS -->
  <g transform="translate(330,530)">
    <rect x="0" y="0" width="260" height="44" rx="6" fill="#2a0a0a" stroke="#991b1b" stroke-width="1"/>
    <text x="130" y="16" text-anchor="middle" fill="#881337" font-family="system-ui,sans-serif" font-size="9">Debug with:</text>
    <text x="130" y="32" text-anchor="middle" fill="#fb7185" font-family="ui-monospace,monospace" font-size="10" font-weight="600">kubectl logs -c istio-proxy</text>
  </g>

  <g transform="translate(620,530)">
    <rect x="0" y="0" width="260" height="44" rx="6" fill="#2a0a0a" stroke="#991b1b" stroke-width="1"/>
    <text x="130" y="16" text-anchor="middle" fill="#881337" font-family="system-ui,sans-serif" font-size="9">Check Envoy admin:</text>
    <text x="130" y="32" text-anchor="middle" fill="#fb7185" font-family="ui-monospace,monospace" font-size="10" font-weight="600">:15000/stats | grep reset</text>
  </g>

  <!-- Istio logo watermark -->
  <g transform="translate(1100,60)" opacity="0.12">
    <path d="M0,50 L25,0 L50,50 L25,42 Z" fill="#fb7185"/>
    <path d="M25,42 L25,65" stroke="#fb7185" stroke-width="2.5" stroke-linecap="round"/>
  </g>

  <!-- Title -->
  <text x="600" y="640" text-anchor="middle" fill="#e2e8f0" font-family="system-ui,sans-serif" font-size="18" font-weight="600" opacity="0.5">Debugging Istio Upstream Reset Errors</text>
</svg>
