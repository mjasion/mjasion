---
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'posts'>;
}

const { post } = Astro.props;
const { title, date, description, category, tags, hero } = post.data;

const categoryColors: Record<string, string> = {
  cloud: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300',
  development: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300',
  kubernetes: 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300',
};

// post.id is like "cloud/how-to-setup-aws..." (includes category)
const href = `/posts/${post.id}/`;

const formattedDate = new Date(date).toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'short',
  day: 'numeric',
});

// Estimate reading time
const wordCount = (post.body?.split(/\s+/).length ?? 0);
const readingTime = Math.max(1, Math.ceil(wordCount / 200));
---

<a
  href={href}
  class="group block rounded-2xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 overflow-hidden shadow-bento hover:shadow-bento-hover hover:-translate-y-0.5 transition-all duration-200"
>
  {hero && (
    <div class="aspect-[16/9] overflow-hidden bg-gray-100 dark:bg-gray-800">
      <img
        src={typeof hero === 'string' ? hero : hero.src}
        alt={title}
        class="h-full w-full object-cover group-hover:scale-105 transition-transform duration-300"
        loading="lazy"
      />
    </div>
  )}

  <div class="p-5">
    <!-- Category badge -->
    <span class={`inline-block rounded-full px-2.5 py-0.5 text-xs font-medium ${categoryColors[category]}`}>
      {category}
    </span>

    <!-- Title -->
    <h3 class="mt-2 text-lg font-semibold leading-snug text-accent-600 dark:text-accent-400 transition-colors">
      {title}
    </h3>

    <!-- Description -->
    <p class="mt-1.5 text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
      {description}
    </p>

    <!-- Meta -->
    <div class="mt-3 flex items-center gap-3 text-xs text-gray-500 dark:text-gray-500">
      <time datetime={date.toISOString()}>{formattedDate}</time>
      <span>&middot;</span>
      <span>{readingTime} min read</span>
    </div>

    <!-- Tags -->
    {tags.length > 0 && (
      <div class="mt-3 flex flex-wrap gap-1.5">
        {tags.slice(0, 3).map((tag) => (
          <span class="rounded-md bg-gray-100 dark:bg-gray-800 px-2 py-0.5 text-xs text-gray-600 dark:text-gray-400">
            {tag}
          </span>
        ))}
        {tags.length > 3 && (
          <span class="text-xs text-gray-400">+{tags.length - 3}</span>
        )}
      </div>
    )}
  </div>
</a>
