---
// Dev-only theme switcher — rendered conditionally via import.meta.env.DEV in BaseLayout
const themes = [
  { id: '',                  name: 'Default',       gray: '#64748b', accent: '#4f46e5' },
  { id: 'theme-aurora',      name: 'Aurora',        gray: '#14b8a6', accent: '#0d9488' },
  { id: 'theme-forest',      name: 'Forest',        gray: '#22c55e', accent: '#16a34a' },
  { id: 'theme-sunset',      name: 'Sunset',        gray: '#fb923c', accent: '#ea580c' },
  { id: 'theme-rose',        name: 'Rosé',          gray: '#f43f5e', accent: '#e11d48' },
  { id: 'theme-lavender',    name: 'Lavender',      gray: '#a855f7', accent: '#7c3aed' },
  { id: 'theme-carbon',      name: 'Carbon',        gray: '#71717a', accent: '#52525b' },
  { id: 'theme-copper',      name: 'Copper',        gray: '#fbbf24', accent: '#b45309' },
  { id: 'theme-classic',     name: 'Classic',       gray: '#6b7280', accent: '#2563eb' },
  { id: 'theme-crimson',     name: 'Crimson',       gray: '#ef4444', accent: '#dc2626' },
  { id: 'theme-jade',        name: 'Jade',          gray: '#10b981', accent: '#059669' },
  { id: 'theme-midnight',    name: 'Midnight',      gray: '#3b82f6', accent: '#2563eb' },
  { id: 'theme-mocha',       name: 'Mocha',         gray: '#96785a', accent: '#78583a' },
  { id: 'theme-terracotta',  name: 'Mediterranean', gray: '#b09070', accent: '#b45309' },
];
---

<!-- Floating theme picker panel -->
<div
  id="theme-picker"
  class="fixed bottom-4 right-4 z-[100] flex flex-col gap-2
         rounded-2xl border border-gray-200 dark:border-gray-700
         bg-white dark:bg-gray-900 p-3 shadow-lg
         print:hidden"
>
  <div class="flex items-center justify-between">
    <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Theme</span>
    <button
      id="theme-picker-close"
      type="button"
      aria-label="Close theme picker"
      class="rounded-full p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors"
    >
      <svg class="h-3.5 w-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
  <div class="grid grid-cols-5 gap-2">
    {themes.map((theme) => (
      <button
        type="button"
        data-theme-id={theme.id}
        aria-label={`Switch to ${theme.name} theme`}
        class="theme-swatch group relative h-7 w-7 rounded-full border-2 border-transparent
               transition-all duration-150 hover:scale-110
               focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400"
        style={`background: conic-gradient(${theme.accent} 0% 50%, ${theme.gray} 50% 100%);`}
      >
        <span class="pointer-events-none absolute -top-8 left-1/2 -translate-x-1/2
                     rounded-md bg-gray-900 dark:bg-gray-100 px-2 py-0.5
                     text-[10px] font-medium text-white dark:text-gray-900
                     whitespace-nowrap opacity-0 group-hover:opacity-100
                     transition-opacity duration-150">
          {theme.name}
        </span>
      </button>
    ))}
  </div>
</div>

<!-- Small reopen button (visible when picker is closed) -->
<button
  id="theme-picker-open"
  type="button"
  aria-label="Open theme picker"
  class="fixed bottom-4 right-4 z-[100] hidden h-9 w-9 items-center justify-center
         rounded-full border border-gray-200 dark:border-gray-700
         bg-white dark:bg-gray-900 shadow-lg
         text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200
         transition-colors print:hidden"
>
  <svg class="h-4 w-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" d="M4.098 19.902a3.75 3.75 0 005.304 0l6.401-6.402M6.75 21A3.75 3.75 0 013 17.25V4.125C3 3.504 3.504 3 4.125 3h1.5c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 003.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008z" />
  </svg>
</button>

<script is:inline>
  (function () {
    var STORAGE_KEY = 'dev-theme';
    var THEME_CLASSES = ['theme-aurora', 'theme-forest', 'theme-sunset', 'theme-rose', 'theme-lavender', 'theme-carbon', 'theme-copper', 'theme-classic', 'theme-crimson', 'theme-jade', 'theme-midnight', 'theme-mocha', 'theme-terracotta'];
    var html = document.documentElement;
    var picker = document.getElementById('theme-picker');
    var openBtn = document.getElementById('theme-picker-open');

    function updateSwatches() {
      var current = '';
      for (var i = 0; i < THEME_CLASSES.length; i++) {
        if (html.classList.contains(THEME_CLASSES[i])) { current = THEME_CLASSES[i]; break; }
      }
      document.querySelectorAll('.theme-swatch').forEach(function (btn) {
        var isActive = btn.dataset.themeId === current;
        btn.style.borderColor = isActive ? 'var(--color-accent-600, #2563eb)' : 'transparent';
        btn.style.transform = isActive ? 'scale(1.15)' : '';
      });
    }

    function showPicker() {
      if (picker) picker.style.display = 'flex';
      if (openBtn) openBtn.style.display = 'none';
      sessionStorage.removeItem('theme-picker-hidden');
    }

    function hidePicker() {
      if (picker) picker.style.display = 'none';
      if (openBtn) openBtn.style.display = 'flex';
      sessionStorage.setItem('theme-picker-hidden', 'true');
    }

    document.querySelectorAll('.theme-swatch').forEach(function (btn) {
      btn.addEventListener('click', function () {
        THEME_CLASSES.forEach(function (c) { html.classList.remove(c); });
        var themeId = btn.dataset.themeId;
        if (themeId) {
          html.classList.add(themeId);
          localStorage.setItem(STORAGE_KEY, themeId);
        } else {
          localStorage.removeItem(STORAGE_KEY);
        }
        updateSwatches();
      });
    });

    document.getElementById('theme-picker-close').addEventListener('click', hidePicker);
    if (openBtn) openBtn.addEventListener('click', showPicker);

    // Restore hidden state
    if (sessionStorage.getItem('theme-picker-hidden') === 'true') {
      hidePicker();
    }

    updateSwatches();
  })();
</script>
